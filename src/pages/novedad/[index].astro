---
import { fetchGoogleSheetData } from '../../utils/google-sheets';
import Layout from '../../layouts/Layout.astro';
import Navbarlight from "@components/navbar/navbarlight.astro";
import Container from "@components/container.astro";
import { marked } from 'marked'; // Para procesar Markdown
import '../novedades.css';
import Cta from "@components/cta.astro";

// Obtener el índice dinámico de la URL
const { index } = Astro.params;

// Carga de datos en tiempo de ejecución
const { novedades } = await fetchGoogleSheetData();
const novedad = novedades[parseInt(index)] ?? {}; // Evitar errores si el índice no es válido

// Extraer datos de la novedad
const titulo = novedad[0] || "Novedad no encontrada";
const descripcion = novedad[1] || "No se encontró descripción.";
const fecha = novedad[3] || "Fecha no disponible.";
const imagen = novedad[2] || "";
const cuerpoTexto = novedad[4] ? marked(novedad[4]) : "No hay contenido adicional.";
---

<Layout title={titulo}>
  <Navbarlight />

  <!-- Contenedor del banner -->
  <div class="w-full h-[50vh] flex flex-col lg:flex-row">
    <!-- Mitad izquierda: Imagen de fondo -->
    <div 
      class="w-full lg:w-1/3 h-full bg-cover bg-center"
      style={`background-image: url(${imagen || '/default-image.jpg'});`}
    ></div>

    <!-- Mitad derecha: Título -->
    <div class="w-full lg:w-2/3 h-full flex items-center justify-center bg-gray-100">
      <h1 class="text-5xl font-bold text-center text-gray-800 px-8">{titulo}</h1>
    </div>
  </div>

  <!-- Contenedor del contenido -->
  <Container>
    <!-- Bajada -->
    <div class="mt-8">
      <p class="text-2xl text-gray-700 font-semibold mb-2">{descripcion}</p>
      <p class="text-sm text-gray-500">{fecha}</p>
    </div>

    <!-- Cuerpo del texto -->
    <div class="mt-6 markdown-body">
      <div class="text-base text-gray-800 whitespace-pre-wrap leading-relaxed" set:html={cuerpoTexto}></div>
    </div>
            <Cta />

  </Container>
</Layout>
