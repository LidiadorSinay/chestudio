---
import Layout from '../../layouts/Layout.astro';
import { SEO } from "astro-seo";
import Navbarlight from "@components/navbar/navbarlight.astro";
import Container from "@components/container.astro";
import { marked } from 'marked'; // Para procesar Markdown
import Cta from "@components/cta.astro";
import '../novedades.css'

// Importar el archivo JSON desde la carpeta public/data
import novedades from '../../../public/data/novedades.json';

// Obtener el índice dinámico de la URL
const { index } = Astro.params;

// Asegurarse de que el índice sea válido
const novedad = novedades[parseInt(index)] ?? {}; // Evitar errores si el índice no es válido

// Extraer datos de la novedad
const titulo = novedad.titulo || "Novedad no encontrada";
const descripcion = novedad.descripcion || "No se encontró descripción.";
const fecha = novedad.fecha || "Fecha no disponible.";
const imagen = novedad.imagen || "/default-image.jpg";
const cuerpoTexto = novedad.contenido ? marked(novedad.contenido) : "No hay contenido adicional.";

// URL canónica
const canonicalURL = `https://chestudioabogados.com/novedades/${index}`; // URL dinámica
---

<style>
  * {
    font-family: "Archivo", sans-serif;
  }

  h1, h2 {
    font-family: "Literata", serif;
  }
</style>

<Layout title={titulo}>
  <!-- SEO para la novedad dinámica -->
  <SEO
    title={titulo}
    description={descripcion}
    canonical={canonicalURL}
    openGraph={{
      basic: {
        url: canonicalURL,
        type: "article",
        title: titulo,
        description: descripcion,
        image: imagen, // Imagen de la novedad
      },
      image: {
        alt: `Imagen de la novedad: ${titulo}`,
      },
    }}
  />

  <Navbarlight />

  <!-- Contenedor del banner -->
  <div class="w-full flex flex-col lg:flex-row">
    <!-- Mitad izquierda: Imagen -->
    <div class="w-full lg:w-1/3 flex items-center justify-center">
      <img 
        src={imagen} 
        alt={titulo} 
        class="w-full h-auto lg:h-full object-contain lg:object-cover"
      />
    </div>

    <!-- Mitad derecha: Título -->
    <div class="w-full lg:w-2/3 flex items-center justify-center bg-gray-100 py-8 lg:py-0">
      <h1 
        class="text-3xl lg:text-5xl font-bold text-center text-gray-800 px-12 lg:px-20"
      >
        {titulo}
      </h1>
    </div>
  </div>

  <!-- Contenedor del contenido -->
  <Container>
    <!-- Bajada -->
    <div class="mt-8">
      <p class="text-2xl text-gray-700 font-semibold mb-2">{descripcion}</p>
      <p class="text-sm text-gray-500">{fecha}</p>
    </div>

    <!-- Cuerpo del texto -->
    <div class="mt-6 markdown-body">
      <div class="text-base text-gray-800 whitespace-pre-wrap leading-relaxed" set:html={cuerpoTexto}></div>
    </div>

    <Cta />
  </Container>
</Layout>
